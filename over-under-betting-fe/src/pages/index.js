import Head from 'next/head'
import Link from 'next/link'
import React, { useState } from "react"
import { Inter } from 'next/font/google'

import ConnectWalletButton from '@/components/ConnectWalletButton'
import HomeComponent from '@/components/HomeComponent'
import Markets from '@/components/Markets'
import UserDashboard from '@/components/UserDashboard'
import Docs from '@/components/Docs'


import { get_all_hourly_price_data, get_current_six_hour_event_data } from '@/utils/api_calls/over_under_api_calls'

const inter = Inter({ subsets: ['latin'] })


const Home = ({ server_data }) => {
  const btc_data = server_data['btc'];
  const eth_data = server_data['eth'];
  const contract_data = server_data['events'];
  const provider_url = server_data['provider_url'];

  const [btnSelection, setBtnSelection] = useState('home');

  function handleClick(selection) {
    if (selection == 'home' && btnSelection != 'home') {
      setBtnSelection('home');
    } else if (selection == 'markets' && btnSelection != 'markets') {
      setBtnSelection('markets');
    } else if (selection == 'dashboard' && btnSelection != 'dashboard') {
      setBtnSelection('dashboard');
    } else if (selection == 'docs' && btnSelection != 'docs') {
      setBtnSelection('docs');
    }
  }

  return (
    <>
      <Head>
        <title>Over-Under-Betting</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <div className="home-container container-fluid m-auto">
        <div className="navbar row navigation m-auto mt-3 justify-content-center align-items-center">
          <div className='col-sm-1 me-3 d-flex justify-content-center align-items-center'>
            <button onClick={() => handleClick('home')} variant="primary" title='Home' className="nav-link-button btn btn-dark btn-lg">
              <i className="bi bi-house-door"></i>
            </button>
          </div>
          <div className='col-sm-1 me-3 d-flex justify-content-center align-items-center'>
            <button onClick={() => handleClick('markets')} variant="primary" title='Browse Markets' className="nav-link-button btn btn-dark btn-lg">
              <i className="bi bi-graph-up"></i>
            </button>
          </div>
          <div className='col-sm-1  me-3 d-flex justify-content-center align-items-center'>
            <button onClick={() => handleClick('docs')} variant="primary" title='Docs' className="nav-link-button btn btn-dark btn-lg m-auto-2">
              <i className="bi bi-file-text-fill"></i>
            </button>
          </div>
          <div className='col-sm-1  me-3 d-flex justify-content-center align-items-center'>
            <button onClick={() => handleClick('dashboard')} variant="primary" title='Manage participated events' className="nav-link-button btn btn-dark btn-lg m-auto-2">
              <i class="bi bi-columns-gap"></i>
            </button>
          </div>
          <div className='col-sm-1 me-3 d-flex justify-content-center align-items-center'>
            <ConnectWalletButton />
          </div>
        </div>

        <div className="container-fluid m-auto">
          {btnSelection == 'home' && <HomeComponent server_data={server_data} />}
          {btnSelection == 'markets' && <Markets />}
          {btnSelection == 'dashboard' && <UserDashboard />}
          {btnSelection == 'docs' && <Docs />}
        </div>

        <div className="row social-navbar m-auto mt-3 justify-content-center align-items-center">
          <div className="col-sm-1 d-flex justify-content-center align-items-center">
            <Link href="https://linkedin.com/in/james-lynch-14645911a">
              <button title="LinkedIn" variant="primary" className="nav-link-button mb-1">
                <i className="bi bi-linkedin"></i>
              </button>
            </Link>
          </div>
          <div className="col-sm-1 d-flex justify-content-center align-items-center">
            <Link href="https://github.com/j1m5s3">
              <button title="GitHub" variant="primary" className="nav-link-button mb-1">
                <i className="bi bi-github"></i>
              </button>
            </Link>
          </div>
        </div>

      </div>
    </>
  )
}

// For now just get data for charts
export const getServerSideProps = async () => {
  const price_data = await get_all_hourly_price_data(24);
  const contract_data = await get_current_six_hour_event_data();
  const provider_url = process.env.NEXT_SEPOLIA_URL;

  const server_data = {
    btc: price_data.btc,
    eth: price_data.eth,
    events: contract_data,
    provider_url: provider_url
  }

  return {
    props: { server_data }
  };
};

export default Home;
